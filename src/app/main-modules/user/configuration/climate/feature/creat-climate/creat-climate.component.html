
<div class="container-fluid">
  <div class="row">
    <form [formGroup]="form" class="form" enctype="multipart/form-data" (ngSubmit)="createClimate()">
      <div class="col-lg-12">
      <div class="card">
        <div class="card-header flex-card-header">
          <strong *ngIf="!regionId"> تعریف<small> شهر و اقلیم </small>  </strong>
          <strong *ngIf="regionId"> ویرایش<small> شهر و اقلیم </small>  </strong>
          <div class="d-flex">
            <button class="btn btn-outline-primary" [routerLink]="'/index/user/configuration/climateList'"> لیست </button> 
          </div>
        </div>     
        <p class="alert alert-success">
          <span [innerHTML]="region"></span>
        </p>
        <div class="card-body">
          <!-- اطلاعات شهر و اقلیم -->
          <div class="form-group row">
            <!-- استان -->
            <div class="mb-4 col-md-2">
                <div class="w-100">
                  <label for="province" class="form-label">استان</label>
                  <select id="province"
                          class="form-control text-right"
                          [(ngModel)]="climateDto.province"
                          formControlName="province"
                          name="province">
                          <!-- (change)="setEnumUseType(true)" -->
                          <option *ngFor="let item of provinceEnum | enumKeyValue" [value]="item.key">
                      {{item.value}}
                    </option>
                  </select>
                </div>
                <app-alert-error [data]="form.controls['province']" [touched]="touched"></app-alert-error>
            </div>  
            <!-- شهر -->
            <div class="mb-4 col-md-2">
              <div class="w-100">
                <label for="city" class="form-label"> شهر</label>
                <input class="form-control text-right" id="city" city=""
                  [(ngModel)]="climateDto.city"
                  formControlName="city"
                  name="city">
              </div>
                  <app-alert-error [data]="form.controls['city']" [touched]="touched"></app-alert-error>
            </div>
            <!-- روستا -->
            <div class="mb-4 col-md-2">
              <div class="w-100">
                <label for="village" class="form-label"> روستا</label>
                <input class="form-control text-right" id="village" placeholder =""
                      [(ngModel)]="climateDto.village"
                      formControlName="village"
                      name="village">
              </div>
                    <app-alert-error [data]="form.controls['village']" [touched]="touched"></app-alert-error>
            </div> 
            <!-- طول جغرافیایی -->
            <div class="mb-4 col-md-2">
                <div class="w-100">
                  <label for="longitude" class="form-label"> طول جغرافیایی</label>
                  <input class="form-control text-right" id="longitude" placeholder=""
                      type="number" step="0.01"
                        [(ngModel)]="climateDto.longitude"
                        formControlName="longitude"
                        name="longitude">
                </div>
                    <app-alert-error [data]="form.controls['longitude']" [touched]="touched"></app-alert-error>
            </div> 
            <!-- عرض جغرافیایی -->
            <div class="mb-4 col-md-2">
              <div class="w-100">
                <label for="latitude" class="form-label"> عرض جغرافیایی</label>
                <input class="form-control text-right" id="latitude" placeholder=""  
                type="number" step="0.01"
                [(ngModel)]="climateDto.latitude"
                formControlName="latitude"
                name="latitude">
              </div>
                  <app-alert-error [data]="form.controls['latitude']" [touched]="touched"></app-alert-error>
            </div> 
            <!--  ارتفاع از سطح دریا -->
            <div class="mb-4 col-md-2">
              <div class="w-100">
                <label for="height" class="form-label"> ارتفاع از سطح دریا </label>
                <input class="form-control text-right" id="height" placeholder=""
                      [(ngModel)]="climateDto.height"
                      formControlName="height"
                      name="height">
              </div>
                <app-alert-error [data]="form.controls['height']" [touched]="touched"></app-alert-error>
            </div> 
            <!-- نوع اقلیم -->
            <div class="mb-4 col-md-2">
              <div class="w-100">
                <label for="climateType" class="form-label">نوع اقلیم</label>
                <select id="climateType"
                        class="form-control text-right"
                        [(ngModel)]="climateDto.climateType"
                        (change)="setEnumUseType(true)"
                        formControlName="climateType"
                        name="climateType">
                  <option *ngFor="let item of climateTypeEnum | enumKeyValue" [value]="item.key">
                    {{item.value}}
                  </option>
                </select>
              </div>
              <app-alert-error [data]="form.controls['climateType']" [touched]="touched"></app-alert-error>
            </div>                
            <!-- نیاز غالب حرارتی -->
            <div class="mb-4 col-md-2">
              <div class="w-100">
                <label for="dominantThermalReq" class="form-label"> نیاز غالب حرارتی </label>
                <input class="form-control text-right" id="dominantThermalReq" placeholder=""
                      [(ngModel)]="climateDto.dominantThermalReq"
                      formControlName="dominantThermalReq"
                      name="dominantThermalReq">
              </div>
                <app-alert-error [data]="form.controls['dominantThermalReq']" [touched]="touched"></app-alert-error>
            </div> 
            <!-- درجه انرژی -->
            <div class="mb-4 col-md-2">
              <div class="w-100">
                <label for="energyDegree" class="form-label"> درجه انرژی </label>
                <input class="form-control text-right" id="energyDegree" placeholder=""
                      [(ngModel)]="climateDto.energyDegree"
                      formControlName="energyDegree"
                      name="energyDegree">
              </div>
            <app-alert-error [data]="form.controls['energyDegree']" [touched]="touched"></app-alert-error>
            </div>           
          </div>      
        </div>
        <!-- ثبت اطلاعات  -->
        <div class="card-footer">
          <button type="submit" class="btn btn-success text-center ml-3" *ngIf="!climateDto.climateType">ثبت</button>
          <button type="submit" class="btn btn-success text-center ml-3" *ngIf="climateDto.climateType">ویرایش</button>
          <!-- <button class="btn btn-sm btn-danger" type="reset"> پاکسازی فرم</button> -->
        </div>
      </div>
      </div> 
    </form>
  </div>
  <!--  آرشیو اطلاعات آب و هوا -->
  <!-- <div *ngIf="climateDto.climateType">  -->
  <div > 
    <div class="row" style="padding-top: 20px;">
      <div class="col-lg-12">
        <div class="card border-primary">
          <!-- عنوان جدول -->
          <div class="card-header flex-card-header">
            <strong id= "billingSearchId"> لیست<small>   اطلاعات آب و هوا </small>   </strong>
            <div class="d-flex">
              <a href="assets/templateFiles/weather template.xlsx" download="weatherTemplate.xlsx">
                نمونه فایل اطلاعات آب و هوا
              </a>
              <button class="btn btn-outline-primary text-center" data-toggle="modal" data-target=".bd-example-modal-lg"   style="margin-right: 20px;">
                <span class="cursor-pointer fa fa-file-excel-o"></span></button>
              </div>
          </div> 
          <form [formGroup]="weatherForm" class="form" enctype="multipart/form-data" (ngSubmit)="updateweatherList()">
            <fieldset class="fieldset-border" >
              <div class="form-group row">
                <div class="row" style="padding: 20px;">
                 <!-- تاریخ شروع -->
                  <div class="col-md-3">
                    <div class="w-100">
                      <label for="fromDate" class="form-label">از تاریخ</label>
                      <input class="form-control text-right" id="fromDate" placeholder=""
                      formControlName="fromDate"
                      name="fromDate">
                    </div>
                    <app-alert-error [data]="weatherForm.controls['fromDate']" [touched]="touched"></app-alert-error>
                  </div>
                  <!-- تاریخ اتمام -->
                  <div class="col-md-3">
                    <div class="w-100">
                      <label for="toDate" class="form-label">تا تاریخ </label>
                      <input class="form-control text-right" id="toDate" placeholder=""
                      formControlName="toDate"
                      name="toDate">
                    </div>
                    <app-alert-error [data]="weatherForm.controls['toDate']" [touched]="touched"></app-alert-error>
                  </div>
                  <!-- فراخوانی داده ها -->
                  <div class="col-md-4" style="align-self: self-end;">
                    <button class="btn btn-primary text-center ">فراخوانی داده ها </button>
                  </div>
                </div>
              </div>
            </fieldset>
          </form>
          <!-- جدول آب و هوای روزانه  -->
          <div class="card-body">
            <div class="col-12">
              <div class="table-responsive">
                <table class="table table-striped table-bordered">
                  <thead class="thead-light">
                    <tr>
                      <th scope="col"> تاریخ </th>
                      <th scope="col">  حداکثر دما</th>
                      <th scope="col">  حداقل دما</th>
                      <th scope="col"> میانگین دما</th>
                      <th scope="col">  حداکثر رطوبت</th>
                      <th scope="col">  حداقل رطوبت</th>
                      <th scope="col">  میانگین رطوبت</th>
                      <th scope="col">میانگین تابش خورشید</th>
                      <th scope="col"> میانگین سرعت باد </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let weather of xlsxWeatherArchive; let i = index" class="vertical-align-middle">
                      <td>{{moment.getJaliliDateFromIso(weather.forDate)}}</td>
                      <td>{{weather.tempMax | number:'0.0-2'}}</td>
                      <td>{{weather.tempMin | number:'0.0-2'}}</td>
                      <td>{{weather.tempAvg | number:'0.0-2'}}</td>
                      <td>{{weather.humidityMin | number:'0.0-2'}}</td>
                      <td>{{weather.humidityMax | number:'0.0-2'}}</td>
                      <td>{{weather.humidityAvg | number:'0.0-2'}}</td>
                      <td>{{weather.sunRad | number:'0.0-2'}}</td>
                      <td>{{weather.wind | number:'0.0-2'}}</td>
                    </tr>
                  </tbody>
                  <tfoot>
                    <tr class="vertical-align-middle; table-dark"> 
                      <td>میانگین</td>
                      <td>{{weatherAvg.tempMax | number:'0.0-2'}}</td>
                      <td>{{weatherAvg.tempMin  | number:'0.0-2'}}</td>
                      <td>{{weatherAvg.tempAvg | number:'0.0-2'}}</td>
                      <td>{{weatherAvg.humidityMin | number:'0.0-2'}}</td>
                      <td>{{weatherAvg.humidityMax | number:'0.0-2'}}</td>
                      <td>{{weatherAvg.humidityAvg | number:'0.0-2'}}</td>
                      <td>{{weatherAvg.sunRad | number:'0.0-2'}}</td>
                      <td>{{weatherAvg.wind | number:'0.0-2'}}</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>      
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- افزودن قبض برق از اکسل -->
<div class="modal fade bd-example-modal-lg"  id="myModal"  tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"> ویرایش اطلاعات آب و هوا از اکسل</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="card-header flex-card-header">
        <input type="file" class="form-control-file"  (change)="onFileChange($event)" multiple="false" />
      </div>
       
      <div class="col-12">
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead class="thead-light">
              <tr>
                <th scope="col"> تاریخ </th>
                <th scope="col">  حداکثر دما</th>
                <th scope="col">  حداقل دما</th>
                <th scope="col"> میانگین دما</th>
                <th scope="col">  حداکثر رطوبت</th>
                <th scope="col">  حداقل رطوبت</th>
                <th scope="col">  میانگین رطوبت</th>
                <th scope="col">میانگین تابش خورشید</th>
                <th scope="col"> میانگین سرعت باد </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let weather of xlsxWeatherList; let i = index" class="vertical-align-middle">
                <td>{{moment.getJaliliDateFromIso(weather.forDate)}}</td>
                <td>{{weather.tempMax | number:'0.0-2'}}</td>
                <td>{{weather.tempMin | number:'0.0-2'}}</td>
                <td>{{weather.tempAvg | number:'0.0-2'}}</td>
                <td>{{weather.humidityMin | number:'0.0-2'}}</td>
                <td>{{weather.humidityMax | number:'0.0-2'}}</td>
                <td>{{weather.humidityAvg | number:'0.0-2'}}</td>
                <td>{{weather.sunRad | number:'0.0-2'}}</td>
                <td>{{weather.wind | number:'0.0-2'}}</td>
              </tr>
            </tbody>
          </table>
          <div class="col-12">
            <button class="btn btn-primary text-center ml-3" (click)="saveXlsxData()">ثبت </button>
          </div>
        </div>
      </div>   
    </div>
  </div>
</div>